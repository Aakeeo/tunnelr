# Caddyfile - Automatic HTTPS configuration
#
# Environment variables:
#   BASE_DOMAIN - Your domain (e.g., tunnel.example.com)
#   SSL_EMAIL   - Email for Let's Encrypt notifications

# Main domain - shows landing page and status
{$BASE_DOMAIN:localhost} {
	reverse_proxy server:8080
}

# Wildcard subdomain - handles all tunnels
*.{$BASE_DOMAIN:localhost} {
	# For localhost (development), use internal CA
	# For real domains, Caddy auto-fetches Let's Encrypt certs
	tls {$SSL_EMAIL:internal}

	# Forward to tunnel server, preserving the original host
	reverse_proxy server:8080 {
		header_up Host {host}
	}
}
