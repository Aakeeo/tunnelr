# docker-compose.yml
# Production-ready configuration
#
# Quick start:
#   1. Copy .env.example to .env
#   2. Edit .env with your domain
#   3. Run: docker compose up -d
#
# Check status: curl https://yourdomain.com/status

services:
  # Caddy - reverse proxy with automatic HTTPS
  caddy:
    image: caddy:2-alpine
    restart: unless-stopped
    ports:
      - "80:80"     # HTTP (redirects to HTTPS)
      - "443:443"   # HTTPS
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
    environment:
      - BASE_DOMAIN=${BASE_DOMAIN:-localhost}
      - SSL_EMAIL=${SSL_EMAIL:-}
    depends_on:
      - server

  # Tunnel server
  server:
    build: .
    restart: unless-stopped
    environment:
      - BASE_DOMAIN=${BASE_DOMAIN:-localhost}
      - ROUTING_MODE=${ROUTING_MODE:-subdomain}
      - PORT=8080

volumes:
  caddy_data:
  caddy_config:
